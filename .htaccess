# =============================

# üöÄ Strapi .htaccess for Namecheap cPanel

# =============================

# Force HTTPS and remove www

<IfModule mod_rewrite.c>
  RewriteEngine On

# Redirect www to non-www

RewriteCond %{HTTP_HOST} ^www\.(._)$ [NC]
RewriteRule ^(._)$ https://%1/$1 [L,R=301]

# Redirect HTTP to HTTPS

RewriteCond %{HTTPS} off
RewriteRule ^ https://%{HTTP_HOST}%{REQUEST_URI} [L,R=301]

# Passenger startup (Namecheap/CloudLinux)

PassengerAppRoot /home/comidtuy/cms
PassengerBaseURI /
PassengerAppType node
PassengerStartupFile server.js
PassengerNodejs /opt/alt/alt-nodejs20/bin/node
</IfModule>

# =============================

# üì¶ Static Asset Caching

# =============================

<IfModule mod_expires.c>
  ExpiresActive On
  ExpiresByType image/jpg "access plus 1 year"
  ExpiresByType image/jpeg "access plus 1 year"
  ExpiresByType image/gif "access plus 1 year"
  ExpiresByType image/png "access plus 1 year"
  ExpiresByType image/webp "access plus 1 year"
  ExpiresByType text/css "access plus 1 month"
  ExpiresByType text/javascript "access plus 1 month"
  ExpiresByType application/javascript "access plus 1 month"
  ExpiresByType application/json "access plus 1 month"
  ExpiresByType application/font-woff2 "access plus 1 year"
  ExpiresDefault "access plus 7 days"
</IfModule>

# =============================

# üîí Security Headers

# =============================

<IfModule mod_headers.c>
  Header always set X-Frame-Options "SAMEORIGIN"
  Header always set X-XSS-Protection "1; mode=block"
  Header always set X-Content-Type-Options "nosniff"
  Header always set Referrer-Policy "strict-origin-when-cross-origin"
  Header always set Permissions-Policy "geolocation=(), microphone=(), camera=()"
</IfModule>

# =============================

# üö´ Protect Sensitive Files

# =============================

<FilesMatch "^(\.env|package\.json|package-lock\.json|composer\.json|yarn\.lock|webpack\.config\.js|README\.md)$">
Order allow,deny
Deny from all
</FilesMatch>

# =============================

# ‚öôÔ∏è Fallback Handling

# =============================

# Serve static files if they exist, otherwise let Passenger handle requests

<IfModule mod_rewrite.c>
  RewriteCond %{REQUEST_FILENAME} !-f
  RewriteCond %{REQUEST_FILENAME} !-d
  RewriteRule ^(.*)$ http://127.0.0.1:1337/$1 [P,L]
</IfModule>

# =============================

# ‚úÖ End of File

# =============================
